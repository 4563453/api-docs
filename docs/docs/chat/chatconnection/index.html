<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta name="generator" content="Hugo 0.79.1" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Connecting to Chat#Glimesh uses WebSockets to allow for communication between you and the chat API. To connect to a chat you will need an access token or a client ID. Keep in mind that using a client ID will keep you in read-only mode for chat environments. The access token must have the chat scope to post messages.
Preparing the Connection#First, build your URL that you will connect to.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="" />
<meta property="og:description" content="Connecting to Chat#Glimesh uses WebSockets to allow for communication between you and the chat API. To connect to a chat you will need an access token or a client ID. Keep in mind that using a client ID will keep you in read-only mode for chat environments. The access token must have the chat scope to post messages.
Preparing the Connection#First, build your URL that you will connect to." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://glimesh.github.io/api-docs/docs/chat/chatconnection/" />

<title>Chat Connection | API-Docs</title>
<link rel="manifest" href="/api-docs/manifest.json">
<link rel="icon" href="/api-docs/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/api-docs/book.min.cafcf4f6a44d3ee127aa860ce997d010fb01fb3b272a748a0c57947d1c5db35d.css" integrity="sha256-yvz09qRNPuEnqoYM6ZfQEPsB&#43;zsnKnSKDFeUfRxds10=">
<script defer src="/api-docs/en.search.min.f229901e9f4d0d13707bf46effca2edf0722606b89e851f91b980206d4bd079e.js" integrity="sha256-8imQHp9NDRNwe/Ru/8ou3wciYGuJ6FH5G5gCBtS9B54="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  <script src="https://kit.fontawesome.com/a076d05399.js"></script>
</head>

<body dir=>
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/api-docs"><img src="/api-docs/glimesh.png" alt="Logo" /><span>API-Docs</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-bf7b3283e3790c00c8caaa140299052b" class="toggle"  />
    <label for="section-bf7b3283e3790c00c8caaa140299052b" class="flex justify-between">
      <a  class="">Api</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ed972e555096d8550e03791bdee2d785" class="toggle"  />
    <label for="section-ed972e555096d8550e03791bdee2d785" class="flex justify-between">
      <a  class="">Query Api</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://glimesh.github.io/api-docs/docs/api/query-api/basic-query/" class="">Basic Query</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://glimesh.github.io/api-docs/docs/api/query-api/nodejs/node-query/" class="">Node Query</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-77b689354c3957af984655a0c2fd22a8" class="toggle"  />
    <label for="section-77b689354c3957af984655a0c2fd22a8" class="flex justify-between">
      <a  class="">Authencation</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-aebb5af2da1c119d07d9f85dc9a357bc" class="toggle"  />
    <label for="section-aebb5af2da1c119d07d9f85dc9a357bc" class="flex justify-between">
      <a  class="">Access Token</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://glimesh.github.io/api-docs/docs/authencation/accesstoken/accesstoken/" class="">Access Token</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://glimesh.github.io/api-docs/docs/authencation/accesstoken/nodejs/node-access-token/" class="">Node Access Token</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-8169bead43f336d6f8a5a3a9e0c253a4" class="toggle"  />
    <label for="section-8169bead43f336d6f8a5a3a9e0c253a4" class="flex justify-between">
      <a  class="">Refresh Token</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://glimesh.github.io/api-docs/docs/authencation/refreshtoken/refreshtoken/" class="">Refresh Token</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-05db2d31fc2e5a419ce9fd1c0e938e4e" class="toggle" checked />
    <label for="section-05db2d31fc2e5a419ce9fd1c0e938e4e" class="flex justify-between">
      <a  class="">Chat</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://glimesh.github.io/api-docs/docs/chat/chatconnection/" class=" active">Chat Connection</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-084ba1dbb512652712ad881ff8045610" class="toggle"  />
    <label for="section-084ba1dbb512652712ad881ff8045610" class="flex justify-between">
      <a  class="">Reference</a>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://glimesh.github.io/api-docs/docs/reference/scopes/" class="">Scopes</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://glimesh.github.io/api-docs/docs/contributing/" class="">Contributing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://glimesh.github.io/api-docs/docs/dev-app/" class="">Dev App</a>
  

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/api-docs/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Chat Connection</strong>

  <label for="toc-control">
    
    <img src="/api-docs/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  <nav id="TableOfContents">
  <ul>
    <li><a href="#preparing-the-connection">Preparing the Connection</a></li>
    <li><a href="#joining-chat">Joining Chat</a></li>
    <li><a href="#incoming-messages">Incoming Messages</a></li>
    <li><a href="#sending-messages">Sending Messages</a></li>
    <li><a href="#connection-issues">Connection Issues</a></li>
  </ul>
</nav>


  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="connecting-to-chat">
  Connecting to Chat
  <a class="anchor" href="#connecting-to-chat">#</a>
</h1>
<p>Glimesh uses WebSockets to allow for communication between you and the chat API.  To connect to a chat you will need an access token or a client ID. Keep in mind that using a client ID will keep you in read-only mode for chat environments. The access token must have the <code>chat</code> scope to post messages.</p>
<h2 id="preparing-the-connection">
  Preparing the Connection
  <a class="anchor" href="#preparing-the-connection">#</a>
</h2>
<p>First, build your URL that you will connect to.  It should look like this:</p>
<pre><code class="language-URL" data-lang="URL">wss://glimesh.tv/api/socket/websocket?vsn=2.0.0&amp;token=TOKEN_HERE
</code></pre><p>That URL is for access token authentication. If you are using a client ID use this instead:</p>
<pre><code class="language-URL" data-lang="URL">wss://glimesh.tv/api/socket/websocket?vsn=2.0.0&amp;client_id=CLIENT_ID
</code></pre><blockquote>
<p>Make sure to replace TOKEN_HERE or CLIENT_ID with the proper token or ID.</p>
</blockquote>
<p>Start by opening a secure websocket connection to the URL you are using. When the connection is opened we send Glimesh a join request in JSON format to stay connected to the socket.  The array below is a example of what this should look like.</p>
<pre><code>[&quot;1&quot;,&quot;1&quot;,&quot;__absinthe__:control&quot;,&quot;phx_join&quot;,{}]
</code></pre><p>Notice that this is a JSON array. Some WebSocket libraries only allow you to send strings or specially formatted JSON. Sometimes you need to encase the data in a string. If the connection closes immediately you may need to change the type of your request.  This depends purely on your library, if you are having trouble talk to us in our <a href="https://discord.gg/Glimesh">discord.</a></p>
<blockquote>
<p>JS example using the ws NPM package:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JS" data-lang="JS"><span style="color:#a6e22e">connection</span>.<span style="color:#a6e22e">send</span>([<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;__absinthe__:control&#34;</span>,<span style="color:#e6db74">&#34;phx_join&#34;</span>,{}]);  <span style="color:#75715e">// Doesn&#39;t work :(
</span><span style="color:#75715e"></span><span style="color:#a6e22e">connection</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;[&#34;1&#34;,&#34;1&#34;,&#34;__absinthe__:control&#34;,&#34;phx_join&#34;,{}]&#39;</span>);  <span style="color:#75715e">// Option 1
</span><span style="color:#75715e"></span><span style="color:#a6e22e">connection</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>([<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;__absinthe__:control&#34;</span>,<span style="color:#e6db74">&#34;phx_join&#34;</span>,{}])); <span style="color:#75715e">//Safer option
</span></code></pre></div></blockquote>
<p>The first value is the join ref. The second is the normal ref. They can be useful for multi-connections but we will use the value of 1 for all refs in this doc. The third is the topic. The fourth is the event.  The fifth is for a payload. Glimesh does not require a payload for this request so we can leave this blank <em>{}</em> .</p>
<p>If Glimesh successfully receives our request we will get a response similar to what we sent. Notice that the first two values are the same. The response tells us that Glimesh is ready.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JSON" data-lang="JSON">[<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;__absinthe__:control&#34;</span>,<span style="color:#e6db74">&#34;phx_reply&#34;</span>,{<span style="color:#f92672">&#34;response&#34;</span>:{},<span style="color:#f92672">&#34;status&#34;</span>:<span style="color:#e6db74">&#34;ok&#34;</span>}]
</code></pre></div><h2 id="joining-chat">
  Joining Chat
  <a class="anchor" href="#joining-chat">#</a>
</h2>
<p>Now that Glimesh has accepted our connection we can connect to a chat. You will need a channel ID for the channel you want to connect to. If you do not know the channel ID you can query the API for it. Simply replace Mytho with the proper user.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-GraphQL" data-lang="GraphQL">
<span style="color:#66d9ef">query</span> {
  <span style="color:#a6e22e">channel</span>(username: <span style="color:#e6db74">&#34;Mytho&#34;</span>) {
    <span style="color:#a6e22e">id</span>
  }
}

</code></pre></div><blockquote>
<p>Remember: Channel IDs and user IDs are different things. Everyone is a user but not everyone has a channel.</p>
</blockquote>
<p>Once you have the ID we can join the chat. Send this through the connection:</p>
<pre><code>[&quot;1&quot;,&quot;1&quot;,&quot;__absinthe__:control&quot;,&quot;doc&quot;,{&quot;query&quot;:&quot;subscription{ chatMessage(channelId: 6) { user { username avatar } message } }&quot;,&quot;variables&quot;:{} ]
</code></pre><p><em>Make sure to replace 6 with your channel ID!</em> The query we just sent will determine what data is sent to us every time a chat message appears in chat. In this example we requested the message and the user who sent it. We ask for the username and avatar of the user in the <code>user</code> object.</p>
<blockquote>
<p>To view a list of everything you can request check out the API docs <a href="https://glimesh.tv/api">here</a> (Docs =&gt; subscription =&gt; chatMessage).</p>
</blockquote>
<p>Glimesh will send us a response:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JSON" data-lang="JSON">[<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;__absinthe__:control&#34;</span>,<span style="color:#e6db74">&#34;phx_reply&#34;</span>,{<span style="color:#f92672">&#34;response&#34;</span>:{<span style="color:#f92672">&#34;subscriptionId&#34;</span>:<span style="color:#e6db74">&#34;__absinthe__:doc:-576460752303349214:33B2AA3BF7B8F0E158810EF0E0166F5E05840BE57444C92365C921943942A47D&#34;</span>},<span style="color:#f92672">&#34;status&#34;</span>:<span style="color:#e6db74">&#34;ok&#34;</span>}]
</code></pre></div><p>Now we are connected to chat! The only thing left to do is send a heartbeat to Glimesh so the connection won&rsquo;t be closed. You need to send a heartbeat every 30 seconds. Structure it as follows:</p>
<pre><code>[&quot;1&quot;,&quot;1&quot;,&quot;phoenix&quot;,&quot;heartbeat&quot;,{}]
</code></pre><p>Glimesh will respond with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JSON" data-lang="JSON">[<span style="color:#e6db74">&#34;null&#34;</span>,<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;phoenix&#34;</span>,<span style="color:#e6db74">&#34;phx_reply&#34;</span>,{<span style="color:#f92672">&#34;response&#34;</span>:{},<span style="color:#f92672">&#34;status&#34;</span>:<span style="color:#e6db74">&#34;ok&#34;</span>}]
</code></pre></div><p>Now Glimesh won&rsquo;t disconnect us  and we have a stable chat connection! Next we will parse incoming messages and send messages back to chat.</p>
<h2 id="incoming-messages">
  Incoming Messages
  <a class="anchor" href="#incoming-messages">#</a>
</h2>
<p>First let&rsquo;s handle incoming messages.  A chat message sent from the API would look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JSON" data-lang="JSON">[<span style="color:#66d9ef">null</span>,<span style="color:#66d9ef">null</span>,<span style="color:#e6db74">&#34;__absinthe__:doc:-576460752298178591:33B2AA3BF7B8F0E158810EF0E0166F5E05840BE57444C92365C921943942A47D&#34;</span>,<span style="color:#e6db74">&#34;subscription:data&#34;</span>,{<span style="color:#f92672">&#34;result&#34;</span>:{<span style="color:#f92672">&#34;data&#34;</span>:{<span style="color:#f92672">&#34;chatMessage&#34;</span>:{<span style="color:#f92672">&#34;message&#34;</span>:<span style="color:#e6db74">&#34;hello world!&#34;</span>,<span style="color:#f92672">&#34;user&#34;</span>:{<span style="color:#f92672">&#34;avatar&#34;</span>:<span style="color:#e6db74">&#34;/uploads/avatars/Mytho.png?v=63762672056&#34;</span>,<span style="color:#f92672">&#34;username&#34;</span>:<span style="color:#e6db74">&#34;Mytho&#34;</span>}}}},<span style="color:#f92672">&#34;subscriptionId&#34;</span>:<span style="color:#e6db74">&#34;__absinthe__:doc:-576460752298178591:33B2AA3BF7B8F0E158810EF0E0166F5E05840BE57444C92365C921943942A47D&#34;</span>}]
</code></pre></div><p>It is returning the data that we requested when we connected to this channel. The subscription ID helps you keep track of which channel the message is from. When you receive a message you need to parse the JSON data. Then you can get any of the data from the response.</p>
<blockquote>
<p>The chat API is being worked on so the structure will likely change in a future update.</p>
</blockquote>
<h2 id="sending-messages">
  Sending Messages
  <a class="anchor" href="#sending-messages">#</a>
</h2>
<p>Next we will send a message back to chat. We must use a mutation to do so.  Send this to chat:</p>
<pre><code>[&quot;1&quot;,&quot;1&quot;,&quot;__absinthe__:control&quot;,&quot;doc&quot;,{&quot;query&quot;:&quot;mutation {createChatMessage(channelId:6, message: {message: \&quot;Hello There!\&quot;}) {message }}&quot;,&quot;variables&quot;:{}}]
</code></pre><blockquote>
<p>Don&rsquo;t forget to replace 6 with your channel ID and Hello World with your message!  The \ before the quotes are used to prevent the JSON structure from breaking. Depending on how your lib handles ws messages they may not be necessary.
The format for sending messages is very strict, ensure Glimesh receives your data as valid JSON.</p>
</blockquote>
<p>Only access tokens with the <code>chat</code> scope can talk in chat. Client IDs are read only. In the above data we requested to have the message returned to us when Glimesh sent it to chat. Glimesh will confirm that the message was received:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JSON" data-lang="JSON">[<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;1&#34;</span>,<span style="color:#e6db74">&#34;__absinthe__:control&#34;</span>,<span style="color:#e6db74">&#34;phx_reply&#34;</span>,{<span style="color:#f92672">&#34;response&#34;</span>:{<span style="color:#f92672">&#34;data&#34;</span>:{<span style="color:#f92672">&#34;createChatMessage&#34;</span>:{<span style="color:#f92672">&#34;message&#34;</span>:<span style="color:#e6db74">&#34;Hello There!&#34;</span>}}},<span style="color:#f92672">&#34;status&#34;</span>:<span style="color:#e6db74">&#34;ok&#34;</span>}]
</code></pre></div><p>This is all the info you will need to connect and use the chat API.  If you have any questions talk to us in our <a href="https://discord.gg/Glimesh">discord!</a></p>
<h2 id="connection-issues">
  Connection Issues
  <a class="anchor" href="#connection-issues">#</a>
</h2>
<p>The most common issue is the connection closing with no message as to why. One of two things has happened:</p>
<ol>
<li>Heartbeat: You must send a heartbeat message to Glimesh every 30 seconds or Glimesh will drop the connection.</li>
<li>Format: The chat API must receive data in the proper format. Most requests will need to be sent in a JSON array. The refs must be surrounded by quotes. The message in the mutation must also contain quotes. You may have to use a backslash to properly format the chat message. <code>\&quot;message data\&quot;</code></li>
</ol>
<p><em>This doc is being revised</em></p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#preparing-the-connection">Preparing the Connection</a></li>
    <li><a href="#joining-chat">Joining Chat</a></li>
    <li><a href="#incoming-messages">Incoming Messages</a></li>
    <li><a href="#sending-messages">Sending Messages</a></li>
    <li><a href="#connection-issues">Connection Issues</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












